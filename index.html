<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ligaplaner</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 2rem; background: #f4f6f9; }
    table { width: 100%; border-collapse: collapse; margin: 1rem 0; background: white; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
    .result-input input { width: 40px; text-align: center; }
    .hidden { display: none; }
    #teamButtons button { margin: 2px; padding: 5px 10px; }
    #spieltagDatumWrapper { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1 style="text-align:center;">Liga-Spielplan</h1>
  <div id="teamButtons"></div>

  <div style="text-align:center; margin-bottom: 1rem;">
    <button onclick="vorherigerSpieltag()">⬅️</button>
    <span id="spieltagLabel">Spieltag 1</span>
    <button onclick="naechsterSpieltag()">➡️</button>
  </div>

  <div style="text-align:center; margin-bottom: 1rem;" id="spieltagDatumWrapper" class="hidden">
    <label for="spieltagDatum">Datum:</label>
    <input type="text" id="spieltagDatum" onchange="updateSpieltagDatum()" />
  </div>
  <div id="anzeigeDatum" style="text-align:center; margin-bottom:10px;"></div>

  <table id="spieltagTabelle">
    <thead>
      <tr><th>Zeit</th><th>Team A</th><th>Team B</th><th>Ergebnis</th></tr>
    </thead>
    <tbody id="spieltagBody"></tbody>
  </table>

  <div style="margin-top:2rem; text-align:center;">
    <input type="password" id="adminPinInput" placeholder="Admin PIN" />
    <button onclick="toggleAdmin()">Anmelden</button>
    <button id="saveButton" onclick="saveAllSpieltagErgebnisse()" style="display:none;">Speichern</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <!-- Spieltagdaten, Logik, Firebase, Admin, Filter, Navigation -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAsneYTXmT7JDUewiJ09LUg1QSZK6Rj_8",
      authDomain: "uni-liga.firebaseapp.com",
      projectId: "uni-liga",
      storageBucket: "uni-liga.appspot.com",
      messagingSenderId: "196698710621",
      appId: "1:196698710621:web:66d13babfc997bab5a3b4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let isAdmin = false;
    let aktuellerSpieltag = 0;
    let selectedTeam = null;

    const spieltage = [
  // SPIELTAG 1
  {
    nummer: 1,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T5", teamB: "T6", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T7", teamB: "T8", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T9", teamB: "T10", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T11", teamB: "T12", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T13", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T15", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T7", teamB: "T15", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T5", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T8", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T6", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T10", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T12", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T5", teamB: "T8", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T6", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T10", teamB: "T7", goalsA: "", goalsB: "" }
    ]
  },
  // SPIELTAG 2
  {
    nummer: 2,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T1", teamB: "T2", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T3", teamB: "T4", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T9", teamB: "T15", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T10", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T11", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T12", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T1", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T3", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T2", teamB: "T15", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T4", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T9", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T10", teamB: "T12", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T9", teamB: "T2", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T13", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T1", teamB: "T12", goalsA: "", goalsB: "" }
    ]
  },
  // SPIELTAG 3
  {
    nummer: 3,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T1", teamB: "T5", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T2", teamB: "T6", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T3", teamB: "T7", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T4", teamB: "T8", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T15", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T14", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T4", teamB: "T6", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T3", teamB: "T5", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T2", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T1", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T7", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T8", teamB: "T15", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T14", teamB: "T5", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T2", teamB: "T12", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T15", teamB: "T1", goalsA: "", goalsB: "" }
    ]
  },
  // SPIELTAG 4
  {
    nummer: 4,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T5", teamB: "T10", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T6", teamB: "T12", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T7", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T8", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T1", teamB: "T3", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T2", teamB: "T4", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T6", teamB: "T8", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T7", teamB: "T5", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T11", teamB: "T3", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T10", teamB: "T2", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T12", teamB: "T4", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T1", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T7", teamB: "T4", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T9", teamB: "T3", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T8", teamB: "T1", goalsA: "", goalsB: "" }
    ]
  },
  // SPIELTAG 5
  {
    nummer: 5,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T2", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T3", teamB: "T15", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T12", teamB: "T7", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T6", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T8", teamB: "T10", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T4", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T12", teamB: "T3", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T8", teamB: "T2", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T6", teamB: "T7", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T10", teamB: "T4", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T15", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T11", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T3", teamB: "T10", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T14", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T2", teamB: "T16", goalsA: "", goalsB: "" }
    ]
  },
  // SPIELTAG 6
  {
    nummer: 6,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T7", teamB: "T1", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T3", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T5", teamB: "T4", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T15", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T13", teamB: "T8", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T9", teamB: "T12", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T1", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T7", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T8", teamB: "T3", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T12", teamB: "T15", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T4", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T5", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T13", teamB: "T7", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T4", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T15", teamB: "T4", goalsA: "", goalsB: "" }
    ]
  },
  // SPIELTAG 7
  {
    nummer: 7,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T13", teamB: "T2", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T4", teamB: "T1", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T16", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T6", teamB: "T10", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T8", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T5", teamB: "T12", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T6", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T4", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T2", teamB: "T5", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T12", teamB: "T8", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T1", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T16", teamB: "T10", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T8", teamB: "T16", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T12", teamB: "T13", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T6", teamB: "T14", goalsA: "", goalsB: "" }
    ]
  },
  // SPIELTAG 8
  {
    nummer: 8,
    datum: "",
    spiele: [
      { zeit: "16:15", teamA: "T5", teamB: "T11", goalsA: "", goalsB: "" },
      { zeit: "16:15", teamA: "T2", teamB: "T7", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T6", teamB: "T1", goalsA: "", goalsB: "" },
      { zeit: "16:35", teamA: "T3", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T13", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "16:55", teamA: "T15", teamB: "T10", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T14", teamB: "T7", goalsA: "", goalsB: "" },
      { zeit: "17:15", teamA: "T2", teamB: "T3", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T13", teamB: "T5", goalsA: "", goalsB: "" },
      { zeit: "17:35", teamA: "T10", teamB: "T15", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T11", teamB: "T9", goalsA: "", goalsB: "" },
      { zeit: "17:55", teamA: "T6", teamB: "T14", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T15", teamB: "T5", goalsA: "", goalsB: "" },
      { zeit: "18:15", teamA: "T3", teamB: "T6", goalsA: "", goalsB: "" },
      { zeit: "18:35", teamA: "T10", teamB: "T11", goalsA: "", goalsB: "" }
    ]
  }
]; // <-- HIER KOMMT DIE GESAMTE SPIELTAGE-DATENSTRUKTUR HIN (alle 8 Spieltage)

    function toggleAdmin() {
      const pin = document.getElementById("adminPinInput").value;
      if (pin === "1234") {
        isAdmin = true;
        document.getElementById("saveButton").style.display = "inline-block";
        renderSpieltag();
      } else {
        alert("Falscher PIN");
      }
    }

    function renderSpieltag() {
      const tag = spieltage[aktuellerSpieltag];
      document.getElementById("spieltagLabel").textContent = `Spieltag ${tag.nummer}`;

      const datumInput = document.getElementById("spieltagDatum");
      const wrapper = document.getElementById("spieltagDatumWrapper");
      if (isAdmin) {
        wrapper.classList.remove("hidden");
        datumInput.value = tag.datum;
      } else {
        wrapper.classList.add("hidden");
      }

      if (!isAdmin && tag.datum) {
        document.getElementById("anzeigeDatum").textContent = `Datum: ${tag.datum}`;
      } else {
        document.getElementById("anzeigeDatum").textContent = "";
      }

      const tbody = document.getElementById("spieltagBody");
      tbody.innerHTML = "";
      tag.spiele.forEach((spiel, index) => {
        const row = document.createElement("tr");
        let ergebnisHTML = "-";
        if (isAdmin) {
          ergebnisHTML = `
            <div class="result-input">
              <input type="number" min="0" value="${spiel.goalsA}" onchange="spieltage[${aktuellerSpieltag}].spiele[${index}].goalsA = this.value" />
              <span>:</span>
              <input type="number" min="0" value="${spiel.goalsB}" onchange="spieltage[${aktuellerSpieltag}].spiele[${index}].goalsB = this.value" />
            </div>`;
        } else if (spiel.goalsA !== "" && spiel.goalsB !== "") {
          ergebnisHTML = `${spiel.goalsA} : ${spiel.goalsB}`;
        }
        row.innerHTML = `
          <td>${spiel.zeit}</td>
          <td>${spiel.teamA}</td>
          <td>${spiel.teamB}</td>
          <td>${ergebnisHTML}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function vorherigerSpieltag() {
      if (aktuellerSpieltag > 0) {
        aktuellerSpieltag--;
        renderSpieltag();
      }
    }

    function naechsterSpieltag() {
      if (aktuellerSpieltag < spieltage.length - 1) {
        aktuellerSpieltag++;
        renderSpieltag();
      }
    }

    function updateSpieltagDatum() {
      const input = document.getElementById("spieltagDatum");
      spieltage[aktuellerSpieltag].datum = input.value;
    }

    function saveAllSpieltagErgebnisse() {
      const batch = db.batch();
      spieltage.forEach((tag, tagIndex) => {
        tag.spiele.forEach((spiel, spielIndex) => {
          const id = `spieltag${tag.nummer}_spiel${spielIndex}`;
          const ref = db.collection("ligaspiele").doc(id);
          batch.set(ref, {
            spieltag: tag.nummer,
            datum: tag.datum,
            zeit: spiel.zeit,
            teamA: spiel.teamA,
            teamB: spiel.teamB,
            goalsA: spiel.goalsA,
            goalsB: spiel.goalsB
          });
        });
      });
      batch.commit().then(() => alert("Alle Spieltage gespeichert!"));
    }

    function ladeAlleSpieltagDaten() {
      db.collection("ligaspiele").get().then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          const tag = spieltage.find(t => t.nummer === data.spieltag);
          if (!tag) return;
          const match = tag.spiele.find(s => s.teamA === data.teamA && s.teamB === data.teamB && s.zeit === data.zeit);
          if (match) {
            match.goalsA = data.goalsA;
            match.goalsB = data.goalsB;
          }
          tag.datum = data.datum;
        });
        renderSpieltag();
      });
    }

    function createTeamButtons() {
      const teams = new Set();
      spieltage.forEach(tag => {
        tag.spiele.forEach(spiel => {
          teams.add(spiel.teamA);
          teams.add(spiel.teamB);
        });
      });
      const container = document.getElementById("teamButtons");
      container.innerHTML = "";
      [...teams].sort().forEach(team => {
        const btn = document.createElement("button");
        btn.textContent = team;
        btn.onclick = () => {
          selectedTeam = team;
          renderSpieltag();
          filterSpieleNachTeam();
        };
        container.appendChild(btn);
      });
      const allBtn = document.createElement("button");
      allBtn.textContent = "Alle anzeigen";
      allBtn.onclick = () => {
        selectedTeam = null;
        renderSpieltag();
      };
      container.appendChild(allBtn);
    }

    function filterSpieleNachTeam() {
      const alleReihen = document.querySelectorAll("#spieltagBody tr");
      alleReihen.forEach(row => row.classList.remove("hidden"));

      if (!selectedTeam) return;

      alleReihen.forEach(row => {
        const tds = row.querySelectorAll("td");
        const teamA = tds[1]?.textContent;
        const teamB = tds[2]?.textContent;
        if (teamA !== selectedTeam && teamB !== selectedTeam) {
          row.classList.add("hidden");
        }
      });
    }

    createTeamButtons();
    ladeAlleSpieltagDaten();
  </script>
</body>
</html>
